---
title: "ITA COVID-19 Monitor"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    social: menu
    source_code: "https://github.com/msaltieri/covid19"
runtime: shiny
---

```{r setup, include=FALSE}
require(covid19)
require(dplyr)
require(flexdashboard)
require(highcharter)
require(magrittr)

# Building the COVID19 object
covid <- Covid$new()$update()
```

Sidebar {.sidebar}
=======================================================================

This is a dashboard representing the outbreak and spread of COVID-19 in
**Italy**.

On historical basis the estimated growing factor is equal to
**`r covid$grow_rate('ITA') %>% round(1) %>% format(decimal.mark = ',')`%**,
corresponding to a doubling time of
**`r log(2) %>% divide_by(1e-2 * covid$grow_rate('ITA')) %>% round(1) %>% format(decimal.mark = ',')` days**.

Forecasts are calculated for **deaths** and **total cases** only, based on
exponential models; prediction intervals with a **95%** confidence level are
shown in the chart too.

```{r}
selectInput(
  inputId = 'log-scale',
  label = 'Please select a scale:',
  choices = list('Linear' = FALSE, 'Logarithmic' = TRUE),
  multiple = FALSE,
  selectize = FALSE
)
```

```{r}
selectInput(
  inputId = 'region',
  label = 'Please select a region:',
  choices = c('Italia' = 'ITA', covid$regions()),
  multiple = FALSE,
  selectize = FALSE
)
```

Prepared with &hearts; by [Hypermynds](www.hypermynds.com).

Dashboard
=======================================================================

Row
-----------------------------------------------------------------------

### Total Cases {.value-box}

```{r}
renderValueBox({
  total_cases <- covid$get(input[['region']]) %>%
      tail(1) %>% 
      pull(totale_casi) %>%
      format(big.mark = '.', decimal.mark = ',')
  valueBox(
    value = total_cases,
    icon = "fa-users"
  )
})
```

### Recovered {.value-box}

```{r}
renderValueBox({
  recovered <- covid$get(input[['region']]) %>%
      tail(1) %>% 
      pull(dimessi_guariti) %>%
      format(big.mark = '.', decimal.mark = ',')
  valueBox(
    value = recovered,
    icon = "fa-thumbs-up"
  )
})
```

### Deaths {.value-box}

```{r}
renderValueBox({
  deaths <- covid$get(input[['region']]) %>%
      tail(1) %>% 
      pull(deceduti) %>%
      format(big.mark = '.', decimal.mark = ',')
  valueBox(
    value = deaths,
    icon = "fa-times",
    color = 'warning'
  )
})
```

Row
-----------------------------------------------------------------------

### Historical Data

```{r}
renderHighchart({
  covid$plot_hist(region = input[['region']], log = input[['log-scale']])
})
```

### Forecast Analysis

```{r}
renderHighchart({
  covid$plot_fore(region = input[['region']], log = input[['log-scale']])
})
```

Raw Data
=======================================================================

```{r}
renderTable({
  covid$table(input[['region']])
})
```
